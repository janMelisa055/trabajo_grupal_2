---
output: pdf_document
fontsize: 12pt
linestretch: 1.5
header-includes:
  - \usepackage[document]{ragged2e}
---

```{r setup, include = FALSE}
setwd("C:/Users/oienh/Documents/R_UNIVERSITY_PROJECTS/5th_Semester/trabajo_grupal_2")
knitr::opts_chunk$set(echo = FALSE, comment = NA)
library(readxl)
library(FinCal)
library(FinancialMath)
library(gt)
```

```{r, echo=FALSE, fig.align = "left"}
knitr::include_graphics("logo.png")
```

\center

# Trabajo Grupal 2
## 2023-04-12/2023-04-14

```{r, echo=FALSE, fig.align = "center"}
knitr::include_graphics("coat_of_arms.png")
```

* Amanda Araya Orrego
* Lucas Oliva Valverde
* Melissa Sumi Ibata
* Exequiel Valdés Zúñiga

\newpage
\justifying

# Introducción 

Los bonos bullet son un tipo de instrumento financiero de renta fija,
el cual se caracteriza por tener un pago total de su capital al final 
de su vencimiento, en estos bonos se utiliza el valor nominal, una fecha
de vencimiento y una tasa de interés fija o variable, en comparación a
otros tipos de bonos como los bonos franceses este no tiene amortización, 
ya que no cuentan con un pago periódico. Principalmente este tipo de
bonos bullet son más atractivos para los inversores que buscan ingresos
a largo plazo o una fuente de ingresos de jubilación, también en proyectos
de empresas e incluso en gobiernos.
En el presente informe se calculara y analizara un bono bullet emitido a
10 años por la empresa Amazon con el fin de evaluar cuidadosamente las
recompensas y los riesgos de este bono bullet para la empresa.

```{r}
equity <- read_excel("wacc.xls",
  range = "A19:L115", sheet = "Industry Averages")
equity <- equity[75, ]

balance <- read_excel("balance.xlsx",  range = "A1:C49")
balance <- balance[-1, ]

pasivo_exigible <- as.numeric(balance[28, 3])

D <- pasivo_exigible * 0.2

tasa_cupon <- as.numeric(equity[1, 7])

# Datos a utilizar.
```

```{r}
dinero_millones <- function(x) {
    ifelse(round(x, 2) != 0,
      paste0("$", format(round(x, 2), big.mark = " ", scientific = FALSE,
    decimal.mark = ","), "M"),
    "$ -")
}
# Formato de dinero en millones para añadir separadores de miles,
# coma decimal, y dos puntos decimales.

porcien <- function(x) {
    paste0(format(round(x, 2), big.mark = " ", scientific = FALSE,
    decimal.mark = ",") * 100, "%")
}
# Formato para porcentajes en estilo SI francés (coma decimal).
```

# Emisión Bonos Bullet

```{r}
# Variables: "ano", "periodo", "saldo_inicial",
# "interes", "capital", "saldo_final".

ano <- as.numeric(seq(0.5, 10, 0.5))

periodo <- 1:20

saldo_inicial <- D

saldo_final <- saldo_inicial

interes <- rep(tasa_cupon / 2 * D, each = length(periodo))

capital <- rep(0, each = length(periodo) - 1)
capital[length(periodo)] <- D

cuota <- interes + capital

for(i in periodo){
saldo_final[i] <- saldo_inicial[i] - capital[i]
saldo_inicial[ifelse(i == length(periodo), NA, i + 1)] <- saldo_final[i]
}
# Ciclo para asignar el saldo final en base al saldo inicial y viceversa.

npv <- NPV(cf0 = D, cf = cuota[20],times = length(periodo), i = tasa_cupon)
# Método formula

vna <- (cuota[20] / D)^(1/length(periodo)) - 1
# Método manual

minus_pv <- -pv(r = vna, n = length(periodo),
   fv = D, pmt = D * vna, type = 0)

cat("Bono Bullet:", dinero_millones(minus_pv))


```

```{r}
`Año` <- ano

substr_right <- function(x, n) {
  substr(x, nchar(x) - n + 1, nchar(x))
}


for(i in periodo) {
`Año`[i] <- ifelse(
  paste0(
    substr_right(round(ano[i], 1), 2)) == ".5",
  paste0(
    ifelse(
      ano[i] - 0.5 == 0, "", ano[i] - 0.5
      ),
      "½"),
 i / 2)
}
# Ciclo para representar años en fracciones.

df <- data.frame(`Año`, "Periodo" = as.character(periodo),
"Saldo Inicial" = dinero_millones(saldo_inicial),
"Cuota" = dinero_millones(cuota),
"Interés" = dinero_millones(interes),
"Capital" = dinero_millones(capital),
"Saldo Final" = dinero_millones(saldo_final))
# Presentación bonita de las figuras.

gt(df)
```

VNA

```{r}
# NPV(cf0 = ,i = 0.2, cf = df$Cuota)
```